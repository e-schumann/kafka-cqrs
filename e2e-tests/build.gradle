description = 'End-to-end tests among multiple services in local cloud instance'

apply plugin: 'groovy'

sourceCompatibility = 1.8
targetCompatibility = 1.8

task e2eTests(type: Test, dependsOn: dockerImageCreationTasks()) {
    description = 'Runs end-to-end tests among multiple services in local cloud instance.'

    doFirst {
        println "Starting in Kubernetes"
        //TODO
        println "Starting in Kubernetes - done"
    }

    doLast {
        println "Stopping in Kubernetes"
        //TODO
        println "Stopping in Kubernetes - done"
    }
}

check.dependsOn e2eTests

def dockerImageCreationTasks() {
    services().collect { it.tasks.getByPath('createDockerImage') }
}

def services() {
    parent.subprojects.findAll { it.name.endsWith('-service') }
}

dependencies {
    testCompile 'org.spockframework:spock-core:1.1-groovy-2.4'
    testCompile 'org.codehaus.groovy.modules.http-builder:http-builder:0.7.1'
}